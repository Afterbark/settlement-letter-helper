<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settlement Payment Extractor Pro</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;

    function SettlementExtractorPro() {
      const [file, setFile] = useState(null);
      const [filePreview, setFilePreview] = useState(null);
      const [loading, setLoading] = useState(false);
      const [extractedData, setExtractedData] = useState(null);
      const [verifications, setVerifications] = useState({});
      const [error, setError] = useState(null);
      const [userNotes, setUserNotes] = useState({});
      const [savedRecords, setSavedRecords] = useState([]);
      const [currentView, setCurrentView] = useState('upload');
      const [searchTerm, setSearchTerm] = useState('');
      const [compareItems, setCompareItems] = useState([]);
      const [validationErrors, setValidationErrors] = useState([]);
      const [currentRecordId, setCurrentRecordId] = useState(null);

      const handleFileUpload = async (e) => {
        const uploadedFile = e.target.files[0];
        if (!uploadedFile) return;

        setFile(uploadedFile);
        setError(null);
        setExtractedData(null);
        setVerifications({});
        setUserNotes({});
        setValidationErrors([]);
        setCurrentRecordId(null);

        const reader = new FileReader();
        reader.onload = (e) => setFilePreview(e.target.result);
        reader.readAsDataURL(uploadedFile);
      };

      const validateExtractedData = (data) => {
        const errors = [];

        if (data.paymentBreakdown.data === 'NOT FOUND') {
          errors.push({ field: 'Payment Breakdown', message: 'CRITICAL: Payment breakdown is missing', severity: 'critical' });
        }
        if (data.firstPaymentDate.data === 'NOT FOUND') {
          errors.push({ field: 'First Payment Date', message: 'WARNING: First payment date not found', severity: 'high' });
        }
        if (data.mailingAddress.data === 'NOT FOUND') {
          errors.push({ field: 'Mailing Address', message: 'CRITICAL: Mailing address is missing', severity: 'critical' });
        }
        if (data.checkPayableTo.data === 'NOT FOUND') {
          errors.push({ field: 'Check Payable To', message: 'CRITICAL: Check payable name is missing', severity: 'critical' });
        }

        const address = data.mailingAddress.data;
        if (address !== 'NOT FOUND') {
          if (!address.match(/\d{5}(-\d{4})?/)) {
            errors.push({ field: 'Mailing Address', message: 'Address may be missing ZIP code', severity: 'medium' });
          }
          if (!address.match(/[A-Z]{2}\s+\d{5}/)) {
            errors.push({ field: 'Mailing Address', message: 'Address may be missing state abbreviation', severity: 'medium' });
          }
        }

        if (data.remittanceTo.data !== 'NOT FOUND' && data.checkPayableTo.data !== 'NOT FOUND') {
          if (data.remittanceTo.data !== data.checkPayableTo.data) {
            errors.push({ field: 'Check Payable To', message: 'INFO: Payable name differs from remittance name - verify this is correct', severity: 'low' });
          }
        }

        const amounts = data.paymentBreakdown.data.match(/\$[\d,]+\.?\d*/g);
        if (amounts && amounts.length > 1) {
          const total = amounts.reduce((sum, amt) => {
            return sum + parseFloat(amt.replace(/[$,]/g, ''));
          }, 0);
          errors.push({ field: 'Payment Breakdown', message: `Total settlement amount: $${total.toFixed(2)}`, severity: 'info' });
        }

        if (data.firstPaymentDate.data !== 'NOT FOUND') {
          const dateMatch = data.firstPaymentDate.data.match(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})/);
          if (dateMatch) {
            const year = dateMatch[3].length === 2 ? '20' + dateMatch[3] : dateMatch[3];
            const date = new Date(`${year}-${dateMatch[1]}-${dateMatch[2]}`);
            const today = new Date();
            if (date < today) {
              errors.push({ field: 'First Payment Date', message: 'WARNING: Payment date appears to be in the past', severity: 'high' });
            }
          }
        }

        return errors;
      };

      const processDocument = async () => {
        if (!file) return;

        setLoading(true);
        setError(null);

        try {
          const base64Data = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });

          const mediaType = file.type === 'application/pdf' ? 'application/pdf' : 
                            file.type.startsWith('image/') ? file.type : 'image/jpeg';

          const contentType = file.type === 'application/pdf' ? 'document' : 'image';

          const response = await fetch('/.netlify/functions/extract', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              model: 'claude-sonnet-4-20250514',
              max_tokens: 4096,
              messages: [{
                role: 'user',
                content: [
                  {
                    type: contentType,
                    source: {
                      type: 'base64',
                      media_type: mediaType,
                      data: base64Data
                    }
                  },
                  {
                    type: 'text',
                    text: `You are analyzing a settlement letter or stipulation letter for debt payment processing. Extract ALL payment-related information with EXTREME accuracy - any mistakes cost money.

Extract and return ONLY a JSON object with this exact structure (no markdown, no preamble):

{
  "paymentBreakdown": {
    "data": "extracted text with all amounts and dates",
    "confidence": "high|medium|low",
    "source": "exact quote from document",
    "notes": "any concerns or clarifications"
  },
  "firstPaymentDate": {
    "data": "date of first payment",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "remittanceTo": {
    "data": "who to remit payment to",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "mailingAddress": {
    "data": "complete mailing address",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "checkPayableTo": {
    "data": "make check payable to name",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "clientName": {
    "data": "client name",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "referenceNumber": {
    "data": "account/reference number for check memo",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  },
  "additionalInstructions": {
    "data": "any special payment instructions or conditions",
    "confidence": "high|medium|low",
    "source": "exact quote",
    "notes": ""
  }
}

CRITICAL RULES:
- If information is NOT clearly stated, set data to "NOT FOUND" and confidence to "low"
- Use "medium" confidence if information is present but unclear or ambiguous
- Use "high" confidence only when information is explicit and unambiguous
- In "source", include the EXACT text from the document
- In "notes", flag ANY concerns: unclear amounts, missing details, ambiguous dates, etc.
- For payment breakdown, include ALL amounts, dates, and payment schedule details
- For firstPaymentDate, extract the specific date when the first payment is due
- Be extremely conservative - when in doubt, mark as medium or low confidence`
                  }
                ]
              }]
            })
          });

          if (!response.ok) {
            const errData = await response.json().catch(() => ({}));
            throw new Error(errData.error?.message || `API Error: ${response.status} ${response.statusText}`);
          }

          const data = await response.json();
          const text = data.content.map(item => item.type === 'text' ? item.text : '').join('\n');
          const cleaned = text.replace(/```json|```/g, '').trim();
          const parsed = JSON.parse(cleaned);

          setExtractedData(parsed);
          
          const initialVerifications = {};
          Object.keys(parsed).forEach(key => {
            initialVerifications[key] = false;
          });
          setVerifications(initialVerifications);

          const errors = validateExtractedData(parsed);
          setValidationErrors(errors);

        } catch (err) {
          console.error('Extraction error:', err);
          setError(`Failed to process document: ${err.message}. Please ensure the API is configured correctly.`);
        } finally {
          setLoading(false);
        }
      };

      const saveRecord = () => {
        if (!extractedData) return;

        const recordId = currentRecordId || `record_${Date.now()}`;
        const record = {
          id: recordId,
          timestamp: new Date().toISOString(),
          fileName: file.name,
          extractedData,
          verifications,
          userNotes,
          validationErrors,
          filePreview
        };

        const updatedRecords = savedRecords.filter(r => r.id !== recordId);
        updatedRecords.unshift(record);
        
        setSavedRecords(updatedRecords);
        setCurrentRecordId(recordId);
        alert('Record saved successfully!');
      };

      const loadRecord = (recordId) => {
        const record = savedRecords.find(r => r.id === recordId);
        if (record) {
          setExtractedData(record.extractedData);
          setVerifications(record.verifications);
          setUserNotes(record.userNotes);
          setValidationErrors(record.validationErrors);
          setFilePreview(record.filePreview);
          setFile({ name: record.fileName });
          setCurrentRecordId(recordId);
          setCurrentView('upload');
        }
      };

      const deleteRecord = (recordId) => {
        if (confirm('Are you sure you want to delete this record?')) {
          const updatedRecords = savedRecords.filter(r => r.id !== recordId);
          setSavedRecords(updatedRecords);
        }
      };

      const exportToCSV = () => {
        if (!extractedData) return;

        const headers = ['Field', 'Value', 'Confidence', 'Source', 'Notes', 'User Notes', 'Verified'];
        const rows = Object.entries(extractedData).map(([key, value]) => [
          fieldLabels[key],
          value.data,
          value.confidence,
          value.source,
          value.notes,
          userNotes[key] || '',
          verifications[key] ? 'Yes' : 'No'
        ]);

        const csv = [headers, ...rows].map(row => 
          row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
        ).join('\n');

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `settlement-${file?.name || 'export'}-${Date.now()}.csv`;
        a.click();
      };

      const copyAllData = () => {
        const text = Object.entries(extractedData).map(([key, value]) => 
          `${fieldLabels[key]}: ${value.data}`
        ).join('\n\n');
        navigator.clipboard.writeText(text);
        alert('All data copied to clipboard!');
      };

      const toggleVerification = (field) => {
        setVerifications(prev => ({
          ...prev,
          [field]: !prev[field]
        }));
      };

      const updateUserNote = (field, note) => {
        setUserNotes(prev => ({
          ...prev,
          [field]: note
        }));
      };

      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text);
      };

      const addToCompare = () => {
        if (extractedData && compareItems.length < 3) {
          setCompareItems([...compareItems, {
            id: Date.now(),
            fileName: file.name,
            data: extractedData
          }]);
        }
      };

      const removeFromCompare = (id) => {
        setCompareItems(compareItems.filter(item => item.id !== id));
      };

      const allVerified = extractedData && Object.keys(verifications).every(key => verifications[key]);
      const hasLowConfidence = extractedData && Object.values(extractedData).some(item => item.confidence === 'low');
      const hasMediumConfidence = extractedData && Object.values(extractedData).some(item => item.confidence === 'medium');
      const criticalErrors = validationErrors.filter(e => e.severity === 'critical');
      const highErrors = validationErrors.filter(e => e.severity === 'high');

      const getConfidenceBadge = (confidence) => {
        const colors = {
          high: 'bg-green-100 text-green-800 border-green-300',
          medium: 'bg-yellow-100 text-yellow-800 border-yellow-300',
          low: 'bg-red-100 text-red-800 border-red-300'
        };
        return colors[confidence] || colors.low;
      };

      const fieldLabels = {
        paymentBreakdown: 'Payment Breakdown',
        firstPaymentDate: 'First Payment Date',
        remittanceTo: 'Remit Payment To',
        mailingAddress: 'Mailing Address',
        checkPayableTo: 'Make Check Payable To',
        clientName: 'Client Name',
        referenceNumber: 'Reference/Account Number',
        additionalInstructions: 'Additional Instructions'
      };

      const filteredRecords = savedRecords.filter(record => {
        const searchLower = searchTerm.toLowerCase();
        return record.fileName.toLowerCase().includes(searchLower) ||
               record.extractedData.clientName.data.toLowerCase().includes(searchLower) ||
               record.extractedData.checkPayableTo.data.toLowerCase().includes(searchLower);
      });

      return (
        <div className="min-h-screen bg-gray-50">
          {/* Navigation */}
          <div className="bg-white border-b shadow-sm">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between flex-wrap gap-4">
                <h1 className="text-2xl font-bold text-gray-900">Settlement Payment Extractor Pro</h1>
                <div className="flex space-x-2">
                  <button
                    onClick={() => setCurrentView('upload')}
                    className={`px-4 py-2 rounded-lg font-medium ${currentView === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                  >
                    New Upload
                  </button>
                  <button
                    onClick={() => setCurrentView('history')}
                    className={`px-4 py-2 rounded-lg font-medium ${currentView === 'history' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                  >
                    History ({savedRecords.length})
                  </button>
                  <button
                    onClick={() => setCurrentView('compare')}
                    className={`px-4 py-2 rounded-lg font-medium ${currentView === 'compare' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                  >
                    Compare ({compareItems.length})
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto p-6">
            {/* History View */}
            {currentView === 'history' && (
              <div className="bg-white rounded-lg shadow-sm p-6">
                <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                  <h2 className="text-xl font-bold text-gray-900">Saved Records</h2>
                  <input
                    type="text"
                    placeholder="Search by client, creditor, or file..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="px-4 py-2 border rounded-lg w-80"
                  />
                </div>

                {filteredRecords.length === 0 ? (
                  <div className="text-center py-12 text-gray-500">
                    <p>No saved records found</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {filteredRecords.map(record => (
                      <div key={record.id} className="border rounded-lg p-4 hover:bg-gray-50">
                        <div className="flex items-start justify-between flex-wrap gap-4">
                          <div className="flex-1">
                            <div className="flex items-center space-x-3 mb-2 flex-wrap">
                              <span className="font-medium text-gray-900">{record.fileName}</span>
                              <span className="text-sm text-gray-500">
                                {new Date(record.timestamp).toLocaleDateString()} {new Date(record.timestamp).toLocaleTimeString()}
                              </span>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                              <div>
                                <span className="text-gray-600">Client:</span>
                                <span className="ml-2 font-medium">{record.extractedData.clientName.data}</span>
                              </div>
                              <div>
                                <span className="text-gray-600">Creditor:</span>
                                <span className="ml-2 font-medium">{record.extractedData.checkPayableTo.data}</span>
                              </div>
                              <div>
                                <span className="text-gray-600">First Payment:</span>
                                <span className="ml-2 font-medium">{record.extractedData.firstPaymentDate.data}</span>
                              </div>
                            </div>
                          </div>
                          <div className="flex space-x-2">
                            <button
                              onClick={() => loadRecord(record.id)}
                              className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                            >
                              Load
                            </button>
                            <button
                              onClick={() => deleteRecord(record.id)}
                              className="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"
                            >
                              Delete
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Compare View */}
            {currentView === 'compare' && (
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h2 className="text-xl font-bold text-gray-900 mb-6">Compare Settlement Offers</h2>
                
                {compareItems.length === 0 ? (
                  <div className="text-center py-12 text-gray-500">
                    <p>No items to compare. Process documents and add them to comparison.</p>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {compareItems.map(item => (
                      <div key={item.id} className="border rounded-lg p-4">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="font-bold text-gray-900 truncate">{item.fileName}</h3>
                          <button
                            onClick={() => removeFromCompare(item.id)}
                            className="text-red-600 hover:text-red-700"
                          >
                            ‚úï
                          </button>
                        </div>
                        <div className="space-y-3 text-sm">
                          {Object.entries(item.data).map(([key, value]) => (
                            <div key={key}>
                              <span className="text-gray-600 block text-xs">{fieldLabels[key]}</span>
                              <span className="font-medium text-gray-900">{value.data}</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Upload/Process View */}
            {currentView === 'upload' && !extractedData && (
              <div className="bg-white rounded-lg shadow-sm p-8">
                <div className="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-400 transition-colors">
                  <div className="text-4xl mb-4">üìÑ</div>
                  <label className="cursor-pointer">
                    <span className="text-blue-600 hover:text-blue-700 font-medium">
                      Click to upload
                    </span>
                    <span className="text-gray-600"> or drag and drop</span>
                    <input
                      type="file"
                      className="hidden"
                      accept=".pdf,.jpg,.jpeg,.png"
                      onChange={handleFileUpload}
                    />
                  </label>
                  <p className="text-sm text-gray-500 mt-2">PDF, JPG, or PNG (max 10MB)</p>
                </div>

                {file && !loading && !extractedData && (
                  <div className="mt-6">
                    <div className="flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200 flex-wrap gap-4">
                      <span className="text-sm font-medium text-gray-900">{file.name}</span>
                      <button
                        onClick={processDocument}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
                      >
                        Process Document
                      </button>
                    </div>
                  </div>
                )}

                {loading && (
                  <div className="mt-6 text-center">
                    <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p className="mt-2 text-gray-600">Analyzing document...</p>
                  </div>
                )}

                {error && (
                  <div className="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <span className="text-red-800">{error}</span>
                  </div>
                )}
              </div>
            )}

            {/* Results View */}
            {currentView === 'upload' && extractedData && (
              <div className="space-y-6">
                {/* Action Buttons */}
                <div className="bg-white rounded-lg shadow-sm p-4 flex items-center justify-between flex-wrap gap-2">
                  <div className="flex space-x-2 flex-wrap gap-2">
                    <button
                      onClick={saveRecord}
                      className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium"
                    >
                      üíæ Save Record
                    </button>
                    <button
                      onClick={exportToCSV}
                      className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium"
                    >
                      üì• Export CSV
                    </button>
                    <button
                      onClick={copyAllData}
                      className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium"
                    >
                      üìã Copy All
                    </button>
                    {compareItems.length < 3 && (
                      <button
                        onClick={addToCompare}
                        className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium"
                      >
                        ‚öñÔ∏è Add to Compare
                      </button>
                    )}
                  </div>
                  <button
                    onClick={() => {
                      setExtractedData(null);
                      setFile(null);
                      setFilePreview(null);
                      setVerifications({});
                      setUserNotes({});
                      setValidationErrors([]);
                      setCurrentRecordId(null);
                    }}
                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium"
                  >
                    New Document
                  </button>
                </div>

                {/* Validation Errors */}
                {validationErrors.length > 0 && (
                  <div className="space-y-2">
                    {criticalErrors.map((err, idx) => (
                      <div key={idx} className="bg-red-50 border-2 border-red-300 rounded-lg p-4">
                        <h3 className="font-bold text-red-900">‚ö†Ô∏è {err.field}</h3>
                        <p className="text-red-800">{err.message}</p>
                      </div>
                    ))}
                    {highErrors.map((err, idx) => (
                      <div key={idx} className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                        <h3 className="font-bold text-yellow-900">‚ö†Ô∏è {err.field}</h3>
                        <p className="text-yellow-800">{err.message}</p>
                      </div>
                    ))}
                  </div>
                )}

                {/* Warning Banners */}
                {hasLowConfidence && (
                  <div className="bg-red-50 border-2 border-red-300 rounded-lg p-4">
                    <h3 className="font-bold text-red-900 mb-1">üö® CRITICAL: Low Confidence Data Detected</h3>
                    <p className="text-red-800">Some fields have LOW confidence. Review carefully before use - errors cost money!</p>
                  </div>
                )}

                {hasMediumConfidence && (
                  <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                    <h3 className="font-bold text-yellow-900 mb-1">‚ö†Ô∏è WARNING: Medium Confidence Data</h3>
                    <p className="text-yellow-800">Some fields need extra verification. Double-check against the original document.</p>
                  </div>
                )}

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Original Document */}
                  <div className="bg-white rounded-lg shadow-sm p-6">
                    <h2 className="text-lg font-bold text-gray-900 mb-4">üìÑ Original Document</h2>
                    {filePreview && (
                      <div className="border rounded-lg overflow-hidden">
                        {file.type === 'application/pdf' ? (
                          <iframe src={filePreview} className="w-full h-96" title="PDF Preview" />
                        ) : (
                          <img src={filePreview} alt="Uploaded document" className="w-full" />
                        )}
                      </div>
                    )}
                  </div>

                  {/* Extracted Data */}
                  <div className="bg-white rounded-lg shadow-sm p-6">
                    <h2 className="text-lg font-bold text-gray-900 mb-4">Extracted Information</h2>
                    <div className="space-y-4 max-h-[600px] overflow-y-auto">
                      {Object.entries(extractedData).map(([key, value]) => (
                        <div key={key} className={`border-2 rounded-lg p-4 ${
                          value.confidence === 'low' ? 'border-red-300 bg-red-50' :
                          value.confidence === 'medium' ? 'border-yellow-300 bg-yellow-50' :
                          'border-green-300 bg-green-50'
                        }`}>
                          <div className="flex items-start justify-between mb-2">
                            <h3 className="font-bold text-gray-900">{fieldLabels[key]}</h3>
                            <span className={`px-2 py-1 rounded text-xs font-medium border ${getConfidenceBadge(value.confidence)}`}>
                              {value.confidence.toUpperCase()}
                            </span>
                          </div>
                          
                          <div className="mb-3">
                            <p className="text-sm font-medium text-gray-700 mb-1">Extracted Data:</p>
                            <p className="text-gray-900 bg-white p-2 rounded border">{value.data}</p>
                          </div>

                          <div className="mb-3">
                            <p className="text-sm font-medium text-gray-700 mb-1">Source from Document:</p>
                            <p className="text-xs text-gray-600 bg-white p-2 rounded border italic">"{value.source}"</p>
                          </div>

                          {value.notes && (
                            <div className="mb-3">
                              <p className="text-sm font-medium text-gray-700 mb-1">AI Notes:</p>
                              <p className="text-sm text-gray-600 bg-white p-2 rounded border">{value.notes}</p>
                            </div>
                          )}

                          <div className="mb-3">
                            <p className="text-sm font-medium text-gray-700 mb-1">üìù Your Notes:</p>
                            <textarea
                              value={userNotes[key] || ''}
                              onChange={(e) => updateUserNote(key, e.target.value)}
                              placeholder="Add your own notes or corrections..."
                              className="w-full p-2 border rounded text-sm"
                              rows="2"
                            />
                          </div>

                          <div className="flex items-center justify-between mt-3 pt-3 border-t">
                            <label className="flex items-center cursor-pointer">
                              <input
                                type="checkbox"
                                checked={verifications[key] || false}
                                onChange={() => toggleVerification(key)}
                                className="h-4 w-4 text-blue-600 rounded mr-2"
                              />
                              <span className="text-sm font-medium text-gray-700">Manually Verified</span>
                            </label>
                            <button
                              onClick={() => copyToClipboard(value.data)}
                              className="text-blue-600 hover:text-blue-700 text-sm"
                            >
                              üìã Copy
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Verification Status */}
                    <div className={`mt-6 p-4 rounded-lg border-2 ${
                      allVerified ? 'bg-green-50 border-green-300' : 'bg-gray-50 border-gray-300'
                    }`}>
                      {allVerified ? (
                        <div>
                          <p className="font-bold text-green-900">‚úÖ All Fields Verified</p>
                          <p className="text-sm text-green-700">You can now use this data for payment processing</p>
                        </div>
                      ) : (
                        <div>
                          <p className="font-bold text-gray-900">‚ö†Ô∏è Verification Required</p>
                          <p className="text-sm text-gray-700">Check all boxes after verifying against the original document</p>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SettlementExtractorPro />);
  </script>
</body>
</html>